<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="always">
    <title>Smerity.com: Google, make Google Analytics HTTPS by default</title>
    
  <link rel="shortcut icon" href="/media/images/favicon.ico">

    
  
  <meta property="og:title" content="Google, make Google Analytics HTTPS by default">
  
  <meta name="description" content="In December 2013, it was discovered that the NSA uses Google cookies to pinpoint targets for hacking. This is only made possible due to Google Analytics not using HTTPS. More worryingly, the heavy usage of Google Analytics means that most of your web browsing habits can be easily intercepted." />
  <meta property="og:description" content="In December 2013, it was discovered that the NSA uses Google cookies to pinpoint targets for hacking. This is only made possible due to Google Analytics not using HTTPS. More worryingly, the heavy usage of Google Analytics means that most of your web browsing habits can be easily intercepted." />
  <meta name="twitter:description" content="In December 2013, it was discovered that the NSA uses Google cookies to pinpoint targets for hacking. This is only made possible due to Google Analytics not using HTTPS. More worryingly, the heavy usage of Google Analytics means that most of your web browsing habits can be easily intercepted." />
  <!-- Seems excessive, doesn't it? -->
  
  
  <meta property="og:image" content="http://smerity.com/media/images/articles/2013/google_analytics.png" />
  <meta name="twitter:image:src" content="http://smerity.com/media/images/articles/2013/google_analytics.png" />
  <meta name="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Smerity.com" />
  <meta property="og:type" content="article" />
  <meta name="twitter:site" content="@Smerity" />
  <meta name="twitter:creator" content="Smerity" />
  

    
  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
    <script src="/media/js/html5.js"></script>
  <![endif]-->

  
  <link rel="stylesheet" type="text/css" href="/media/compiled_less/bootstrap.css">

  <link rel="stylesheet" type="text/css" href="/media/css/pygments.css">

    
  <script type="text/javascript" src="/media/js/jquery.js"></script>
  <script src="/media/bootstrap/js/bootstrap.js"></script>

    
    
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-470775-5']);
    _gaq.push(['_trackPageview']);
    setTimeout("_gaq.push(['_trackEvent', '15_seconds', 'read'])",15000);
    setTimeout("_gaq.push(['_trackEvent', '30_seconds', 'read'])",30000);
    setTimeout("_gaq.push(['_trackEvent', '60_seconds', 'read'])",60000);
    setTimeout("_gaq.push(['_trackEvent', '120_seconds', 'read'])",120000);
    setTimeout("_gaq.push(['_trackEvent', '240_seconds', 'read'])",240000);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  </head>
  <body>
  


  
  
<div class="hero-box">
  <div class="hero-inner min-padded">
    <a href="/">
      <h3 class="heavy pull-left">&laquo; Smerity.com</h3>
    </a>
    <h3 class="maroon contact-me pull-right">
      <!-- All on one line seems crazy but it prevents small form factors trying to fit them over multiple lines -->
      <a href="https://www.twitter.com/Smerity/" alt="Twitter"><i class="icon-twitter"></i></a><a href="https://facebook.com/smerity" alt="Facebook"><i class="icon-facebook-sign"></i></a><a href="https://github.com/Smerity/" alt="GitHub"><i class="icon-github"></i></a><a href="http://au.linkedin.com/in/smerity" alt="LinkedIn"><i class="icon-linkedin"></i></a><a href="mailto:smerity@smerity.com" alt="Email"><i class="icon-envelope-alt"></i></a>
    </h3>
  </div>
</div>

  <div class="container">
    
      <div class="row">
      <div class="span8 content-wrapper">
        
  

        <div class="content-box">
        
<h1 class="post-title">Google, make Google Analytics HTTPS by default</h1>
<h3 class="post-date">December 26, 2013</h3>
  <!--
<blockquote>
  <p>
    Thanks to the pervasive nature of Google Analytics, the NSA has an easy eavesdropping opportunity that is still open to this day.
  </p>
  <p>
    How can this be fixed?
    Sadly not by the end developer and the majority of end users are either not competent enough to understand or not fully aware of what is happening.
    Google could counter this potential privacy invasion similar to how they have countered previous threats, however.
  </p>
</blockquote>
-->

<!--
Start with authority (Harvard research), reference to past work (HTTP referrers), and social validation (highest voted comment).
-->

<!--
It likely doesn't surprise you to know that most of our dealings on the Internet are tracked.
In this age, information is valuable, stored and catalogued for a myriad of purposes, seldom discarded.
Even if you're not surprised yet, I tend to think you'll be surprised when you realise just how heavily tracked you already are.
-->

<p>Over the past few years, Google have moved closer and closer towards implementing SSL on all their products.
In January 2010, <a href="http://gmailblog.blogspot.com/2010/01/default-https-access-for-gmail.html">Gmail became HTTPS by default</a>.
In October 2011, <a href="http://googleblog.blogspot.com/2011/10/making-search-more-secure.html">Google Search became HTTPS by default</a>.
In September 2013, <a href="http://googledevelopers.blogspot.com.au/2013/09/https-compatible-ad-code-for-adsense.html">Google AdSense added support for serving through HTTPS</a>.</p>
<p>In December 2013, it was discovered that <a href="http://www.washingtonpost.com/blogs/the-switch/wp/2013/12/10/nsa-uses-google-cookies-to-pinpoint-targets-for-hacking/">the NSA uses Google cookies to pinpoint targets for hacking</a>.
This is only made possible due to Google Analytics not using HTTPS.
More worryingly, the heavy usage of Google Analytics means that most of your web browsing habits can be easily intercepted.</p>
<p><strong>Google, make early 2014 when Google Analytics becomes HTTPS by default.</strong></p>
<p>With a flick of a switch, Google can add security against unwanted surveillance for billions of users and webpages across the Internet.</p>
<p class="alert alert-error">
  Before I begin, let me be clear about a few things.
  This is not a statement against <abbr title="I might change my tone if Google acquires Amazon, or the other way around, and an unholy drone army born from Google's driverless car technology and the Bezos drone armada begins hunting down all users who haven't yet given Google their real name for use on YouTube comments.">Google</abbr>, Google Analytics, referrer tracking, or analytics in general.
  Additionally, while I use results from work I did while a student at Harvard University, these opinions are my own.
</p>

<!--
Google Analytics (GA) is one of the most pervasive web analytics tools available on the Internet.
It is used on more than 60% of the top 100,000 domains in the world.
While the percentage of websites using Google Analytics gives a loose indication of how pervasive it is, this is not a true measure of how widely the impact is felt.
If you land on a web page with Google Analytics, a multitude of details are recorded, including the HTTP referrer, or web page that lead you to the current website.
Thus, if every second link you click lands you on a web page that uses Google Analytics, Google might have enough information to reconstruct your entire path.
-->

<!--
The primary aim of this post is to justify how desperately HTTPS by default for Google Analytics is needed:
to understand how pervasive the monitoring of the Internet is using Google Analytics, how this benefits the NSA, and then to urge Google to modify Google Analytics to counter this potential privacy intrusion.
-->

<h2>How much of your browsing history does Google Analytics see?</h2>
<p>Half a year ago, I wrote an article about <a href="http://smerity.com/articles/2013/where_did_all_the_http_referrers_go.html">HTTP referrers</a>.
As a minor tangent to the article, I posed the question <em>"how much of the traffic around the Internet is Google in a place to observe?"</em>, primarily as Google Analytics (GA) is one of the biggest users of HTTP referrers.
Recently I had the opportunity to investigate this question further by <a href="http://smerity.com/cs205_ga/">research conducted for a final project at Harvard University</a>.</p>
<p>Just how pervasive is Google Analytics?
<a href="http://trends.builtwith.com/analytics/Google-Analytics">65.7% of the top 10k sites, 64.2% of the top 100k, and 50.8% of the top million use Google Analytics</a>.
In practical terms, this means that you're either on a domain that is using Google Analytics or <abbr title="Indeed, if you clicked on the BuiltWith link above, that page uses Google Analytics. Oh, and this one does too. Sorry.">your next click will likely land you on one that does</abbr>.</p>
<table class="table">
  <thead>
    <tr>
      <th>N domains</th>
      <th>Source</th>
      <th>Percentage using Google Analytics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Top 10k</td>
      <td>BuiltWith</td>
      <td>65.7%</td>
    </tr>
    <tr>
      <td>Top 100k</td>
      <td>BuiltWith</td>
      <td>64.2%</td>
    </tr>
    <tr>
      <td>Top million</td>
      <td>BuiltWith</td>
      <td>50.8%</td>
    </tr>
    <tr>
      <td>Random 48.5 million</td>
      <td><a href="http://smerity.com/cs205_ga/">C. Hornbaker, S. Merity (2013)</a></td>
      <td>26.96%</td>
    </tr>
  </tbody>
</table>

<p>While the percentage of websites using Google Analytics has been calculated for a specific set of domains, this is not a true measure of how widely the impact is felt.
Some domains have far more webpages than others, and certain domains are also more heavily trafficked.
Most importantly, if you land on a web page with Google Analytics, a multitude of details are recorded, including the HTTP referrer, or web page that lead you to the current website.
<em>Thus, if you happen to land on a web page using Google Analytics on every second link click, Google has enough information to reconstruct your entire path.</em></p>
<p>This line of discussion motivates a simple question.</p>
<ul class="crossed">
  <!--<li>What percentage of web pages on the Internet use GA for tracking their web traffic?-->
  <li>If a web surfer were to click a random link on the Internet, what is the probability that one of those pages has an end-point in Google Analytics?
</ul>

<p>As part of <a href="http://smerity.com/cs205_ga/">our final project</a> for <a href="http://iacs-courses.seas.harvard.edu/courses/cs205/">CS205</a> at Harvard, Chad Hornbaker and I came up with a approximate answer to this question by analyzing 535 million web pages from the <a href="http://commoncrawl.org/">Common Crawl corpus</a>.</p>
<!--
    **Domains:** 13,080,522 / 48,514,036
    **Webpages:** 212,611,840 / 535,673,948
    **Links:** 20,651,207,894 / 42,181,558,679
-->

<p><img class="center" src="/media/images/articles/2013/google_analytics.png" width="280" height="380"></p>
<p>While only 29.96% of the 48.5 million domains surveyed used Google Analytics, 39.69% of the 535 million pages across those domains had Google Analytics, and of the 42 billion links on those pages, 48.96% of them end in a page using Google Analytics, thus reporting a user's browsing history for both that page and the page before it.</p>
<p class="alert alert-info">
  Our work was an approximation as it only used domains instead of the pages themselves, simplifying the computational requirements substantially.
  The full details are on the <a href="http://smerity.com/cs205_ga/">project website</a>.
  The important take-away is that thanks to referrers, Google Analytics gets information from pages that don't have Google Analytics on them, and the "worst case" is that the entire browsing history of a user could be reconstructed, even if not all the pages use Google Analytics.
</p>

<h2>How does that help the NSA?</h2>
<p>Imagine if the NSA wanted to know the browsing history for the majority of users on the Internet.
To perform this, the NSA would need to perform a man-in-the-middle attack for each of the connections it's interested in.
This either means observing all connections as they leave a user or observing all connections as they reach a server of interest.
This doesn't scale well considering the number of users and servers on the Internet.</p>
<p>With Google Analytics, the NSA can sidestep this, as it only has to eavesdrop on all connections to and from the Google Analytics servers.
Not that <a href="http://en.wikipedia.org/wiki/Room_641A">that would ever happen</a>.</p>
<p>We are already aware that <a href="http://www.washingtonpost.com/blogs/the-switch/wp/2013/12/10/nsa-uses-google-cookies-to-pinpoint-targets-for-hacking/">the NSA uses Google cookies to pinpoint targets for hacking</a>.
Even though Google Analytics doesn't have full coverage of the Internet, they have substantial coverage when you add in referrers.
Given the exact same information they've already collected, they can reconstruct partial browsing histories for millions of users.</p>
<p>Hence, the NSA has an economical way to tap a large portion of web traffic, especially considering they already have the required data on hand.</p>
<h3>More than just the NSA</h3>
<p>While this might be exciting for the NSA, it could be even more exciting for other smaller spy agencies.
The tracking information sent to the Google Analytics servers are routed to the nearest server for <abbr title="Curious? Run traceroute google-analytics.com from your server and another in a different geographic region. If you're lucky, it'll tell you the name of the nearest large city on Google's 1e100.net domain. 1e100 is a Googol, in case you'd never come across that fact before.">latency reasons</abbr>.
This means that if I were <abbr title="I'd be a kind and generous dictator, giving free ice-cream on Sundays, destroying only a small number of the country's important cultural and artistic creations, and placing Ryan Gosling's face on the obverse of all national currency.">in control of a small country</abbr> and was interested in tracking my own populace, I would only need to eavesdrop all connections to the nearest Google Analytics server.
This is quite a simple task, especially if you have influence over the local infrastructure providers.
<!--If you have influence over the local infrastructure providers, this likely isn't a very difficult task.--></p>
<!--
For example, the traceroute to `google-analytics.com` from Sydney Australia leads to `syd01s19-in-f17.1e100.net`, while the traceroute from Harvard University leads to `iad23s17-in-f18.1e100.net`.
-->

<h2>Slightly hindering the NSA: HTTP vs HTTPS</h2>
<p>An important note is that, if the website uses HTTPS, Google Analytics will use HTTPS for communicating the tracking information too.
This prevents trivial eavesdropping as the tracking information is no longer sent in the clear.</p>
<p>For any website that uses HTTP, eavesdropping is entirely trivial however, as the tracking information is sent in cleartext.</p>
<h2>Can Google help counter these potential invasions? Forcing HTTPS</h2>
<p>Google have previously reacted to potential invasions of their own and their customer's privacy.
The most recent example was when they <a href="http://www.washingtonpost.com/business/technology/google-encrypts-data-amid-backlash-against-nsa-spying/2013/09/06/9acc3c20-1722-11e3-a2ec-b47e45e6f8ef_story.html">encrypted inter-datacenter communications</a> when it was discovered that <a href="http://www.washingtonpost.com/world/national-security/nsa-infiltrates-links-to-yahoo-google-data-centers-worldwide-snowden-documents-say/2013/10/30/e51d661e-4166-11e3-8b74-d89d714ca4dd_story.html">the NSA had tapped their private fiber networks</a>.</p>
<p>In this situation, they could again act to protect their customers and lessen the impact that Google Analytics has on an end-user's privacy.</p>
<h3>Defending as an individual or company</h3>
<p>By default, if you use Google Analytics on a website run over HTTP, there is nothing you can do to make it resilient to eavesdropping.
As previously stated, if your website is HTTPS, then the information is sent encrypted only to the Google servers.</p>
<p>You might ask, why not just load the HTTPS version of the Google Analytics script?
Good question, but Google Analytics decides how to reply by looking at whether the current page is HTTP or HTTPS.
This means that, even if you load the Google Analytics script over HTTPS instead of HTTP, the reply to the Google servers will be sent in the clear if the page you load is HTTP.</p>
<p>Therefore, if your website is served over HTTP, there is <em>nothing</em> you can do to prevent eavesdropping when using Google Analytics.</p>
<h3>Defending on Google's side</h3>
<p>Google could counter this potential privacy invasion for those exposed to Google Analytics on HTTP websites by forcing the reply to be sent over HTTPS.
There are two options for this: opt in or opt out.</p>
<p>An opt in is the least obstructive method and would enable concerned website owners to tell Google Analytics to send tracking information back over HTTPS even if the website is served over HTTP.
This would likely have a negligible impact on helping to secure the billions of websites and end users across the Internet, however, as the majority of website owners would be unlikely to adopt this simply due to laziness or lack of understanding.</p>
<p>Opt out, or HTTPS by default, is the simplest and most effective way to prevent potential privacy invasions.
<!--
If HTTPS were enabled by default, there would be an increase in the computational work required for every single Google Analytics communication for both the client and Google.
-->
Google are well aware of how to provide SSL/TLS at scale however and have been <a href="https://www.imperialviolet.org/2010/06/25/overclocking-ssl.html">working on the topic for some time</a>.
The largest potential impact might be worse battery life for clients on mobile devices.
In most situations, the overhead for the end user would be negligible.</p>
<h2>Conclusion</h2>
<p>Google, protect your users, enable HTTPS on Google Analytics by default.</p>
<h3>Thanks to...</h3>
<ul class="crossed">
  <li>Harvard University's CS205 and Amazon Web Services for providing the AWS credits for the research.</li>
  <li><a href="http://www.it.usyd.edu.au/~dong7223">Dominick Ng</a> for his insights and thorough proof reading.</li>
  <li>Artists from <a href="http://thenounproject.com/">The Noun Project</a> for the icons used in diagram, specifically <a href="http://thenounproject.com/term/globe/16523/">Pickin Studio</a>, <a href="http://thenounproject.com/term/document/5713/">Maximilian Becker</a> and <a href="http://thenounproject.com/term/network/27392/">Jessica Coccimiglio</a>.</li>
</ul>

        </div>
      </div>
      
        <div class="span3 side-box">
          <div style="padding: 8px;">
            <h1 style="margin-bottom: 0; text-align: center;">Popular Articles</h1>
            <style>
            ul.unstyled li { padding-bottom: 6px; }
            </style>
            <ul class="crossed">
              <li><a href="/articles/2015/keras_qa.html">Question answering on the Facebook bAbi dataset using recurrent neural networks and 175 lines of Python + Keras</a></li>
              <li><a href="/articles/2015/google_sparsehash.html">How Google Sparsehash achieves two bits of overhead per entry using sparsetable</a></li>
              <li><a href="/articles/2013/where_did_all_the_http_referrers_go.html">Where did all the HTTP referrers go?</a></li>
            </ul>
            <div class="well well-small">
              <!--<h1 style="margin-bottom: 0; margin-top: 0; text-align: center;">Hi, I'm Smerity</h1>-->
              <div align="center">
                <!--img class="shadowed pronounced" src="/media/images/smerity_bw.jpg" />-->
              </div>
              <!-- TODO: Place Twitter here -->
              <p>
                I'm <b>Stephen Merity</b>, better known in most places as <b>Smerity</b>.
              </p>
              <p>
                <b>Sydney University:</b><br />
                <a href="http://sydney.edu.au/engineering/it/current_students/undergrad/bit.shtml">BIT</a> (University Medal + First Class Honours)
              </p>
              <p>
                <b>Harvard University:</b><br />
                <a href="http://www.seas.harvard.edu/programs/graduate/computational-science-and-engineering/master-of-science-in-cse">MS in CSE</a>
              </p>
              <p>
                <b><a href="/abme.html">Read more about me</a></b>
              </p>
            </div>
            <p class="center-text">
              <b>Interested in saying hi?</b><br />
              <div class="contact-me">
              <a href="https://www.twitter.com/Smerity/" alt="Twitter"><i class="icon-twitter"></i></a><a href="https://facebook.com/smerity" alt="Facebook"><i class="icon-facebook-sign"></i></a><a href="https://github.com/Smerity/" alt="GitHub"><i class="icon-github"></i></a><a href="http://au.linkedin.com/in/smerity" alt="LinkedIn"><i class="icon-linkedin"></i></a><a href="mailto:smerity@smerity.com" alt="Email"><i class="icon-envelope-alt"></i></a>
              </div>
            </p>

            
          </div>
        </div>
      
      </div>
    
    
<footer>
  You reached the bottom! Reading can be challenging, so I think you deserve a reward. I'd offer you <a href="http://www.minecraftwiki.net/wiki/Cake">cake</a>, but after <a href="http://en.wikipedia.org/wiki/Portal_(video_game)">a certain robot-human conflict</a> started due to cake it may not be a wise choice. So here:
  <div align="center">
    <img src="/media/images/mini_coin.png" height="32" width="32" />
  </div>
  Take a coin. No, not a Bitcoin. Do you know how <a title="When I originally put this note here, Bitcoins were only a few dollars each...">expensive</a> those are? ಠ_ಠ
</footer>

  </div>
  
  
  <link rel="stylesheet" type="text/css" href="/media/css/fontawesome/fontawesome.css" />
  <!--[if lt IE 9]>
    <link rel="stylesheet" type="text/css" href="/media/css/fontawesome/fontawesome-ie7.css" />
  <![endif]-->
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,700' rel='stylesheet' type='text/css'>

  
  </body>
</html>